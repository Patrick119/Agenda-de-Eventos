<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Agenda Personal</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        input, button { margin: 5px; }
    </style>
</head>
<body>
    <h1>Agenda Personal</h1>
    <div>
        <input type="date" id="fecha">
        <input type="time" id="hora">
        <input type="text" id="titulo" placeholder="Título del evento">
        <textarea id="descripcion" placeholder="Descripción del evento"></textarea>
        <button onclick="crearEvento()">Crear Evento</button>
    </div>
    <div>
        <button onclick="verEventos()">Ver Eventos</button>
        <ul id="listaEventos"></ul>
    </div>
<!-- Añadir al final del body en index.html -->
<div id="editModal" style="display:none; position:fixed; top:20%; left:20%; width:60%; background:white; padding:20px; border:2px solid #ccc; z-index:1000;">
    <h2>Editar Evento</h2>
    <label for="editFecha">Fecha:</label>
    <input type="date" id="editFecha">
    <label for="editHora">Hora:</label>
    <input type="time" id="editHora">
    <label for="editTitulo">Título:</label>
    <input type="text" id="editTitulo">
    <label for="editDescripcion">Descripción:</label>
    <textarea id="editDescripcion"></textarea>
    <br>
    <button onclick="guardarEdicion()">Guardar Cambios</button>
    <button onclick="cerrarModal()">Cerrar</button>
</div>

<script>
    async function crearEvento() {
        const fecha = document.getElementById('fecha').value;
        const hora = document.getElementById('hora').value.replace(':', '-');
        const titulo = document.getElementById('titulo').value;
        const descripcion = document.getElementById('descripcion').value;
        const response = await fetch('/eventos', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ fecha, hora, titulo, descripcion })
        });
        const data = await response.json();
        alert(data.message);
        verEventos();
    }

    async function verEventos() {
        const response = await fetch('/eventos');
        const eventos = await response.json();
        const lista = document.getElementById('listaEventos');
        lista.innerHTML = '';
        eventos.forEach(evento => {
            const li = document.createElement('li');
            li.innerHTML = <strong>Fecha:</strong> ${evento.fecha} <strong>Hora:</strong> ${evento.hora} <br><strong>Título:</strong> ${evento.titulo} <br><strong>Descripción:</strong> ${evento.descripcion} <br><button onclick="editarEvento('${evento.fecha}', '${evento.hora}', '${evento.titulo}', '${evento.descripcion}')">Editar</button> <button onclick="borrarEvento('${evento.fecha}', '${evento.hora}')">Borrar</button>;
            lista.appendChild(li);
        });
    }

  async function editarEvento(fecha, hora) {
        document.getElementById('editFecha').value = fecha;
        document.getElementById('editHora').value = hora.replace('-', ':');
        const response = await fetch(/eventos/${fecha}/${hora});
        const data = await response.json();
        document.getElementById('editTitulo').value = data.titulo;
        document.getElementById('editDescripcion').value = data.descripcion;
        document.getElementById('editModal').style.display = 'block';
    }

    async function guardarEdicion() {
        const fecha = document.getElementById('editFecha').value;
        const hora = document.getElementById('editHora').value.replace(':', '-');
        const titulo = document.getElementById('editTitulo').value;
        const descripcion = document.getElementById('editDescripcion').value;
        const response = await fetch(/eventos/${fecha}/${hora}, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ titulo, descripcion })
        });
        const data = await response.json();
        alert(data.message);
        document.getElementById('editModal').style.display = 'none';
        verEventos();
    }

    function cerrarModal() {
        document.getElementById('editModal').style.display = 'none';
    }
    async function borrarEvento(fecha, hora) {
        const response = await fetch(/eventos/${fecha}/${hora}, {
            method: 'DELETE'
        });
        const data = await response.json();
        alert(data.message);
        verEventos();
    }
</script>

</body>
</html>
